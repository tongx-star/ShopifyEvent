# Vercel KV 配置指南

## 💾 什么是Vercel KV？

Vercel KV是基于Redis的键值数据库服务，专为无服务器应用设计。

## 💰 定价信息（2024年最新）

### 免费套餐 (Hobby)
- ✅ **30,000次读取操作/月**
- ✅ **1,000次写入操作/月**  
- ✅ **256MB存储空间**
- ✅ **1个数据库**
- ⏰ **最大请求时间: 10秒**

### 付费套餐 (Pro)
- 💰 **$20/月起**
- ✅ **100万次读取操作/月**
- ✅ **100,000次写入操作/月**
- ✅ **1GB存储空间**
- ✅ **无限数据库**
- ⏰ **最大请求时间: 60秒**

## 🎯 对于此项目的需求评估

### 预计使用量
```
每个商店配置: ~10次写入/月 (配置更新)
每个转化事件: ~3次写入 + 1次读取
每月1000订单的商店: ~4000次操作

结论: 免费套餐足够支持10-20个小型商店
```

## 🚀 配置步骤

### 第一步：创建KV数据库

1. 在Vercel项目中，点击 **"Storage"** 标签
2. 点击 **"Create Database"**
3. 选择 **"KV"**
4. 输入数据库名称：`google-ads-pixel-db`
5. 选择区域（建议选择用户最近的区域）
6. 点击 **"Create"**

### 第二步：获取连接信息

创建完成后，Vercel会显示连接信息：
```bash
KV_REST_API_URL=https://xxx-xxx-xxx.upstash.io
KV_REST_API_TOKEN=AxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxBxxxxxxxxxxxxxxx
```

### 第三步：配置环境变量

1. 在Vercel项目设置中，找到 **"Environment Variables"**
2. 添加以下变量：
   ```bash
   KV_REST_API_URL=你的KV_URL
   KV_REST_API_TOKEN=你的KV_TOKEN
   ```
3. 确保选择 **"Production"**, **"Preview"**, **"Development"** 环境

### 第四步：重新部署

1. 在Vercel项目中点击 **"Deployments"**
2. 点击最新部署旁的菜单 → **"Redeploy"**
3. 确认重新部署

## 💡 成本优化建议

### 1. 开发阶段
- 使用项目内置的内存存储（免费）
- 仅在生产环境使用KV

### 2. 生产阶段
- 监控使用量，大部分小型应用免费套餐足够
- 实现数据过期策略，自动清理旧数据

### 3. 扩展阶段  
- 超过免费限制时，考虑升级到Pro套餐
- 或实现数据分片策略

## 🔧 数据结构设计

项目中的数据使用模式：
```javascript
// 商店配置 - 每个商店1条记录
`config:${shop}` → 配置JSON

// 会话信息 - 每个商店1条记录  
`session:${shop}` → 会话JSON

// 事件统计 - 可定期清理
`stats:${shop}:${date}` → 统计数据
```

## ⚠️ 重要提醒

1. **备份策略**: Vercel KV不提供自动备份，建议实现数据导出功能
2. **数据迁移**: 如需更换存储服务，确保有数据迁移方案
3. **监控使用**: 定期检查使用量，避免超出限制
4. **开发测试**: 可以使用本地Redis进行开发测试 