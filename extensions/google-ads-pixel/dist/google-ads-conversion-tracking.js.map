{
  "version": 3,
  "sources": ["../../../../node_modules/@shopify/web-pixels-extension/build/esm/globals.mjs", "../../../../node_modules/@shopify/web-pixels-extension/build/esm/register.mjs", "../../../../extensions/google-ads-pixel/src/index.js"],
  "sourceRoot": "/Users/tongx/Desktop/WorkSpace/ShopifyEvent/extensions/google-ads-pixel/src",
  "sourcesContent": ["const EXTENSION_POINT = 'WebPixel::Render';\n\nexport { EXTENSION_POINT };\n", "import { EXTENSION_POINT } from './globals.mjs';\n\nconst register = extend => shopify.extend(EXTENSION_POINT, extend);\n\nexport { register };\n", "import { register } from '@shopify/web-pixels-extension';\n\nregister(({ analytics, settings }) => {\n  // \u83B7\u53D6\u914D\u7F6E\n  const conversionId = settings.conversion_id;\n  const purchaseLabel = settings.purchase_label;\n  const addToCartLabel = settings.add_to_cart_label;\n  const beginCheckoutLabel = settings.begin_checkout_label;\n  const enhancedConversions = settings.enhanced_conversions;\n\n  // \u9A8C\u8BC1\u5FC5\u8981\u914D\u7F6E\n  if (!conversionId || !purchaseLabel) {\n    console.warn('[Google Ads Pixel] Missing required configuration');\n    return;\n  }\n\n  // \u52A0\u8F7DGoogle Ads gtag\n  function loadGoogleAds() {\n    if (window.gtag) {\n      initializeTracking();\n      return;\n    }\n\n    const script = document.createElement('script');\n    script.async = true;\n    script.src = `https://www.googletagmanager.com/gtag/js?id=${conversionId}`;\n    script.onload = initializeTracking;\n    script.onerror = () => console.error('[Google Ads Pixel] Failed to load gtag');\n    \n    document.head.appendChild(script);\n  }\n\n  // \u521D\u59CB\u5316Google Ads\u8FFD\u8E2A\n  function initializeTracking() {\n    window.dataLayer = window.dataLayer || [];\n    function gtag() { dataLayer.push(arguments); }\n    window.gtag = window.gtag || gtag;\n\n    gtag('js', new Date());\n    gtag('config', conversionId);\n    \n    console.log(`[Google Ads Pixel] Initialized with ID: ${conversionId}`);\n  }\n\n  // \u5B89\u5168\u7684\u6570\u503C\u89E3\u6790\n  function safeParseFloat(value) {\n    if (typeof value === 'number') return value;\n    if (typeof value === 'string') return parseFloat(value) || 0;\n    return 0;\n  }\n\n  // \u8D2D\u4E70\u5B8C\u6210\u4E8B\u4EF6\n  analytics.subscribe('checkout_completed', (event) => {\n    if (!purchaseLabel) return;\n\n    try {\n      const checkout = event.data.checkout;\n      const conversionData = {\n        send_to: `${conversionId}/${purchaseLabel}`,\n        value: safeParseFloat(checkout.totalPrice.amount),\n        currency: checkout.currencyCode,\n        transaction_id: checkout.order?.id || checkout.token\n      };\n\n      // \u589E\u5F3A\u8F6C\u5316\u6570\u636E\n      if (enhancedConversions) {\n        if (checkout.email) conversionData.email = checkout.email;\n        if (checkout.phone) conversionData.phone_number = checkout.phone;\n        if (checkout.billingAddress) {\n          const addr = checkout.billingAddress;\n          if (addr.firstName) conversionData.first_name = addr.firstName;\n          if (addr.lastName) conversionData.last_name = addr.lastName;\n          if (addr.address1) conversionData.address = {\n            street: addr.address1,\n            city: addr.city,\n            region: addr.province,\n            postal_code: addr.zip,\n            country: addr.country\n          };\n        }\n      }\n\n      window.gtag('event', 'conversion', conversionData);\n      console.log('[Google Ads Pixel] Purchase conversion sent:', conversionData);\n\n    } catch (error) {\n      console.error('[Google Ads Pixel] Purchase event error:', error);\n    }\n  });\n\n  // \u52A0\u8D2D\u7269\u8F66\u4E8B\u4EF6\n  if (addToCartLabel) {\n    analytics.subscribe('product_added_to_cart', (event) => {\n      try {\n        const cartLine = event.data.cartLine;\n        const merchandise = cartLine.merchandise;\n        \n        const conversionData = {\n          send_to: `${conversionId}/${addToCartLabel}`,\n          value: safeParseFloat(cartLine.cost.totalAmount.amount),\n          currency: cartLine.cost.totalAmount.currencyCode,\n          items: [{\n            item_id: merchandise.id,\n            item_name: merchandise.product.title,\n            item_variant: merchandise.title,\n            quantity: cartLine.quantity,\n            price: safeParseFloat(merchandise.price.amount)\n          }]\n        };\n\n        window.gtag('event', 'conversion', conversionData);\n        console.log('[Google Ads Pixel] Add to cart conversion sent:', conversionData);\n\n      } catch (error) {\n        console.error('[Google Ads Pixel] Add to cart event error:', error);\n      }\n    });\n  }\n\n  // \u5F00\u59CB\u7ED3\u8D26\u4E8B\u4EF6\n  if (beginCheckoutLabel) {\n    analytics.subscribe('checkout_started', (event) => {\n      try {\n        const checkout = event.data.checkout;\n        \n        const conversionData = {\n          send_to: `${conversionId}/${beginCheckoutLabel}`,\n          value: safeParseFloat(checkout.totalPrice.amount),\n          currency: checkout.currencyCode,\n          items: checkout.lineItems.map(item => ({\n            item_id: item.variant.id,\n            item_name: item.variant.product.title,\n            item_variant: item.variant.title,\n            quantity: item.quantity,\n            price: safeParseFloat(item.variant.price.amount)\n          }))\n        };\n\n        window.gtag('event', 'conversion', conversionData);\n        console.log('[Google Ads Pixel] Begin checkout conversion sent:', conversionData);\n\n      } catch (error) {\n        console.error('[Google Ads Pixel] Begin checkout event error:', error);\n      }\n    });\n  }\n\n  // \u521D\u59CB\u5316\n  loadGoogleAds();\n}); "],
  "mappings": "MAAA,IAAMA,EAAkB,mBCExB,IAAMC,EAAWC,GAAU,QAAQ,OAAOC,EAAiBD,CAAM,ECAjEE,EAAS,CAAC,CAAE,UAAAC,EAAW,SAAAC,CAAS,IAAM,CAEpC,IAAMC,EAAeD,EAAS,cACxBE,EAAgBF,EAAS,eACzBG,EAAiBH,EAAS,kBAC1BI,EAAqBJ,EAAS,qBAC9BK,EAAsBL,EAAS,qBAGrC,GAAI,CAACC,GAAgB,CAACC,EAAe,CACnC,QAAQ,KAAK,mDAAmD,EAChE,MACF,CAGA,SAASI,GAAgB,CACvB,GAAI,OAAO,KAAM,CACfC,EAAmB,EACnB,MACF,CAEA,IAAMC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAQ,GACfA,EAAO,IAAM,+CAA+CP,CAAY,GACxEO,EAAO,OAASD,EAChBC,EAAO,QAAU,IAAM,QAAQ,MAAM,wCAAwC,EAE7E,SAAS,KAAK,YAAYA,CAAM,CAClC,CAGA,SAASD,GAAqB,CAC5B,OAAO,UAAY,OAAO,WAAa,CAAC,EACxC,SAASE,GAAO,CAAE,UAAU,KAAK,SAAS,CAAG,CAC7C,OAAO,KAAO,OAAO,MAAQA,EAE7BA,EAAK,KAAM,IAAI,IAAM,EACrBA,EAAK,SAAUR,CAAY,EAE3B,QAAQ,IAAI,2CAA2CA,CAAY,EAAE,CACvE,CAGA,SAASS,EAAeC,EAAO,CAC7B,OAAI,OAAOA,GAAU,SAAiBA,EAClC,OAAOA,GAAU,UAAiB,WAAWA,CAAK,GAAK,CAE7D,CAGAZ,EAAU,UAAU,qBAAuBa,GAAU,CApDvD,IAAAC,EAqDI,GAAKX,EAEL,GAAI,CACF,IAAMY,EAAWF,EAAM,KAAK,SACtBG,EAAiB,CACrB,QAAS,GAAGd,CAAY,IAAIC,CAAa,GACzC,MAAOQ,EAAeI,EAAS,WAAW,MAAM,EAChD,SAAUA,EAAS,aACnB,iBAAgBD,EAAAC,EAAS,QAAT,YAAAD,EAAgB,KAAMC,EAAS,KACjD,EAGA,GAAIT,IACES,EAAS,QAAOC,EAAe,MAAQD,EAAS,OAChDA,EAAS,QAAOC,EAAe,aAAeD,EAAS,OACvDA,EAAS,gBAAgB,CAC3B,IAAME,EAAOF,EAAS,eAClBE,EAAK,YAAWD,EAAe,WAAaC,EAAK,WACjDA,EAAK,WAAUD,EAAe,UAAYC,EAAK,UAC/CA,EAAK,WAAUD,EAAe,QAAU,CAC1C,OAAQC,EAAK,SACb,KAAMA,EAAK,KACX,OAAQA,EAAK,SACb,YAAaA,EAAK,IAClB,QAASA,EAAK,OAChB,EACF,CAGF,OAAO,KAAK,QAAS,aAAcD,CAAc,EACjD,QAAQ,IAAI,+CAAgDA,CAAc,CAE5E,OAASE,EAAO,CACd,QAAQ,MAAM,2CAA4CA,CAAK,CACjE,CACF,CAAC,EAGGd,GACFJ,EAAU,UAAU,wBAA0Ba,GAAU,CACtD,GAAI,CACF,IAAMM,EAAWN,EAAM,KAAK,SACtBO,EAAcD,EAAS,YAEvBH,EAAiB,CACrB,QAAS,GAAGd,CAAY,IAAIE,CAAc,GAC1C,MAAOO,EAAeQ,EAAS,KAAK,YAAY,MAAM,EACtD,SAAUA,EAAS,KAAK,YAAY,aACpC,MAAO,CAAC,CACN,QAASC,EAAY,GACrB,UAAWA,EAAY,QAAQ,MAC/B,aAAcA,EAAY,MAC1B,SAAUD,EAAS,SACnB,MAAOR,EAAeS,EAAY,MAAM,MAAM,CAChD,CAAC,CACH,EAEA,OAAO,KAAK,QAAS,aAAcJ,CAAc,EACjD,QAAQ,IAAI,kDAAmDA,CAAc,CAE/E,OAASE,EAAO,CACd,QAAQ,MAAM,8CAA+CA,CAAK,CACpE,CACF,CAAC,EAICb,GACFL,EAAU,UAAU,mBAAqBa,GAAU,CACjD,GAAI,CACF,IAAME,EAAWF,EAAM,KAAK,SAEtBG,EAAiB,CACrB,QAAS,GAAGd,CAAY,IAAIG,CAAkB,GAC9C,MAAOM,EAAeI,EAAS,WAAW,MAAM,EAChD,SAAUA,EAAS,aACnB,MAAOA,EAAS,UAAU,IAAIM,IAAS,CACrC,QAASA,EAAK,QAAQ,GACtB,UAAWA,EAAK,QAAQ,QAAQ,MAChC,aAAcA,EAAK,QAAQ,MAC3B,SAAUA,EAAK,SACf,MAAOV,EAAeU,EAAK,QAAQ,MAAM,MAAM,CACjD,EAAE,CACJ,EAEA,OAAO,KAAK,QAAS,aAAcL,CAAc,EACjD,QAAQ,IAAI,qDAAsDA,CAAc,CAElF,OAASE,EAAO,CACd,QAAQ,MAAM,iDAAkDA,CAAK,CACvE,CACF,CAAC,EAIHX,EAAc,CAChB,CAAC",
  "names": ["EXTENSION_POINT", "register", "extend", "EXTENSION_POINT", "register", "analytics", "settings", "conversionId", "purchaseLabel", "addToCartLabel", "beginCheckoutLabel", "enhancedConversions", "loadGoogleAds", "initializeTracking", "script", "gtag", "safeParseFloat", "value", "event", "_a", "checkout", "conversionData", "addr", "error", "cartLine", "merchandise", "item"]
}
